<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Product Details - ShopEasy</title>
    <link rel="stylesheet" href="styles.css" />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      .product-detail-container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem;
      }

      .product-detail-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 3rem;
        margin-bottom: 3rem;
      }

      .product-image-section {
        position: relative;
      }

      .product-main-image {
        width: 100%;
        height: 400px;
        object-fit: cover;
        border-radius: 0.75rem;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      }

      .product-badges {
        position: absolute;
        top: 1rem;
        left: 1rem;
        display: flex;
        gap: 0.5rem;
      }

      .product-actions-top {
        position: absolute;
        top: 1rem;
        right: 1rem;
        display: flex;
        gap: 0.5rem;
      }

      .action-btn {
        background: rgba(255, 255, 255, 0.9);
        border: none;
        padding: 0.5rem;
        border-radius: 50%;
        cursor: pointer;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
      }

      .product-info-section {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }

      .product-meta {
        display: flex;
        gap: 0.5rem;
        margin-bottom: 1rem;
      }

      .meta-badge {
        padding: 0.25rem 0.75rem;
        border-radius: 1rem;
        font-size: 0.75rem;
        font-weight: 500;
      }

      .category-badge {
        background: #eff6ff;
        color: #1d4ed8;
        border: 1px solid #dbeafe;
      }

      .brand-badge {
        background: #f3f4f6;
        color: #374151;
        border: 1px solid #d1d5db;
      }

      .product-title {
        font-size: 2rem;
        font-weight: 700;
        color: #111827;
        margin-bottom: 1rem;
      }

      .product-rating-section {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 1rem;
      }

      .rating-display {
        display: flex;
        align-items: center;
        gap: 0.5rem;
      }

      .rating-stars {
        display: flex;
      }

      .rating-text {
        font-size: 1.125rem;
        font-weight: 600;
      }

      .reviews-text {
        color: #6b7280;
      }

      .price-section {
        margin-bottom: 1.5rem;
      }

      .price-display {
        display: flex;
        align-items: center;
        gap: 1rem;
        margin-bottom: 0.5rem;
      }

      .current-price {
        font-size: 2rem;
        font-weight: 700;
        color: #111827;
      }

      .original-price {
        font-size: 1.25rem;
        color: #6b7280;
        text-decoration: line-through;
      }

      .savings-text {
        color: #10b981;
        font-weight: 600;
      }

      .stock-status {
        margin-bottom: 1.5rem;
      }

      .in-stock {
        background: #d1fae5;
        color: #065f46;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
        display: inline-block;
      }

      .out-of-stock {
        background: #fee2e2;
        color: #991b1b;
        padding: 0.5rem 1rem;
        border-radius: 0.5rem;
        font-weight: 500;
        display: inline-block;
      }

      .description-section {
        margin-bottom: 1.5rem;
      }

      .section-title {
        font-size: 1.125rem;
        font-weight: 600;
        margin-bottom: 0.5rem;
      }

      .features-list {
        list-style: disc;
        list-style-position: inside;
        margin-left: 1rem;
      }

      .features-list li {
        margin-bottom: 0.5rem;
        color: #374151;
      }

      .action-buttons {
        display: flex;
        gap: 1rem;
        margin-bottom: 1.5rem;
      }

      .btn-large {
        flex: 1;
        padding: 1rem 2rem;
        font-size: 1rem;
        font-weight: 600;
      }

      .services-card {
        background: white;
        border: 1px solid #e5e7eb;
        border-radius: 0.75rem;
        padding: 1rem;
      }

      .service-item {
        display: flex;
        align-items: center;
        gap: 0.75rem;
        margin-bottom: 0.75rem;
      }

      .service-item:last-child {
        margin-bottom: 0;
      }

      .service-icon {
        width: 1.25rem;
        height: 1.25rem;
      }

      .service-icon.delivery {
        color: #10b981;
      }

      .service-icon.return {
        color: #3b82f6;
      }

      .service-icon.security {
        color: #8b5cf6;
      }

      .service-text {
        font-size: 0.875rem;
        color: #374151;
      }

      .back-button {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        color: #3b82f6;
        text-decoration: none;
        margin-bottom: 1.5rem;
        font-weight: 500;
      }

      .back-button:hover {
        color: #1d4ed8;
      }

      .related-products {
        border-top: 1px solid #e5e7eb;
        padding-top: 3rem;
      }

      @media (max-width: 768px) {
        .product-detail-grid {
          grid-template-columns: 1fr;
          gap: 2rem;
        }

        .product-title {
          font-size: 1.5rem;
        }

        .current-price {
          font-size: 1.5rem;
        }

        .action-buttons {
          flex-direction: column;
        }
      }
    </style>

    <!-- Chatbot Styles -->
    <link rel="stylesheet" href="styles/chatbot.css" />

    <!-- Image Search Styles -->
    <link rel="stylesheet" href="styles/image-search.css" />
  </head>
  <body>
    <!-- Header -->
    <header class="header">
      <div class="header-top">
        <div class="container">
          <div class="header-top-content">
            <div class="header-top-left">
              <span class="location">
                <svg
                  class="location-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path
                    d="M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"
                  />
                  <circle cx="12" cy="10" r="3" />
                </svg>
                Deliver to Mumbai 400001
              </span>
            </div>
            <div class="header-top-right">
              <span>Customer Service</span>
              <span>Sell on ShopEasy</span>
            </div>
          </div>
        </div>
      </div>

      <div class="header-main">
        <div class="container">
          <div class="header-main-content">
            <a href="index.html" class="logo">
              <div class="logo-text">ShopEasy</div>
            </a>

            <form class="search-form" onsubmit="handleSearch(event)">
              <div class="search-wrapper">
                <input
                  type="text"
                  id="searchInput"
                  class="search-input"
                  placeholder="Search for products, brands and more..."
                />
                <button
                  type="button"
                  class="voice-search-btn"
                  onclick="voiceSearch && voiceSearch.startVoiceSearch('products')"
                  title="Voice Search"
                >
                  <span class="voice-icon">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <path
                        d="M12 2a3 3 0 0 0-3 3v7a3 3 0 0 0 6 0V5a3 3 0 0 0-3-3Z"
                      />
                      <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                      <line x1="12" x2="12" y1="19" y2="22" />
                      <line x1="8" x2="16" y1="22" y2="22" />
                    </svg>
                  </span>
                </button>
                <button
                  class="image-search-btn"
                  onclick="imageSearch.openModal()"
                  title="Search by Image"
                >
                  <span class="image-icon">
                    <svg
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                    >
                      <rect x="3" y="3" width="18" height="18" rx="2" ry="2" />
                      <circle cx="9" cy="9" r="2" />
                      <path d="m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21" />
                      <circle cx="17" cy="7" r="1" />
                    </svg>
                  </span>
                </button>
                <button type="submit" class="search-btn">
                  <svg
                    class="search-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <circle cx="11" cy="11" r="8" />
                    <path d="m21 21-4.3-4.3" />
                  </svg>
                </button>
              </div>
            </form>

            <div class="header-right">
              <button class="account-btn" onclick="showUserInsights()">
                <svg
                  class="account-icon"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                >
                  <path d="M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2" />
                  <circle cx="12" cy="7" r="4" />
                </svg>
                <span class="account-text">Account</span>
              </button>

              <a href="cart.html" class="cart-btn">
                <div class="cart-icon-wrapper">
                  <svg
                    class="cart-icon"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="2"
                  >
                    <path
                      d="m9 22 3-3-3-3M3 3h.621a1 1 0 0 1 .958.713l1.42 4.982A1 1 0 0 0 6.957 9H19a1 1 0 0 1 .97 1.243l-2 8A1 1 0 0 1 17 19H6a1 1 0 0 1-.97-.757L2 2H1"
                    />
                    <circle cx="9" cy="22" r="1" />
                    <circle cx="20" cy="22" r="1" />
                  </svg>
                  <span class="cart-count" id="cartCount">0</span>
                </div>
                <span class="cart-text">Cart</span>
              </a>
            </div>
          </div>
        </div>
      </div>

      <div class="header-nav">
        <div class="container">
          <nav class="nav-links">
            <a href="products.html" class="nav-link">All Categories</a>
            <a href="products.html?category=Electronics" class="nav-link"
              >Electronics</a
            >
            <a href="products.html?category=Fashion" class="nav-link"
              >Fashion</a
            >
            <a href="products.html?category=Home & Kitchen" class="nav-link"
              >Home & Kitchen</a
            >
            <a href="products.html?category=Toys & Games" class="nav-link"
              >Toys & Games</a
            >
            <a
              href="products.html?category=Beauty & Personal Care"
              class="nav-link"
              >Beauty</a
            >
            <a href="products.html?category=Sports & Fitness" class="nav-link"
              >Sports</a
            >
            <a href="products.html?category=Books & Stationery" class="nav-link"
              >Books</a
            >
            <a href="products.html?category=Groceries & Food" class="nav-link"
              >Groceries</a
            >
          </nav>
        </div>
      </div>
    </header>

    <!-- Main Content -->
    <main>
      <div class="product-detail-container">
        <!-- Breadcrumb -->
        <nav id="breadcrumb" style="margin-bottom: 1.5rem">
          <!-- Will be populated by JavaScript -->
        </nav>

        <!-- Back Button -->
        <a href="index.html" class="back-button">
          <svg
            style="width: 1rem; height: 1rem"
            viewBox="0 0 24 24"
            fill="none"
            stroke="currentColor"
            stroke-width="2"
          >
            <path d="m12 19-7-7 7-7" />
            <path d="M19 12H5" />
          </svg>
          Back to Products
        </a>

        <!-- Product Detail -->
        <div id="productDetailContainer">
          <!-- Will be populated by JavaScript -->
        </div>

        <!-- Related Products -->
        <div class="related-products" id="relatedProducts">
          <!-- Will be populated by JavaScript -->
        </div>

        <!-- Personalized Recommendations -->
        <div id="productRecommendations">
          <!-- Recommendations will be loaded by JavaScript -->
        </div>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <div class="footer-content">
          <div class="footer-section">
            <h3>ShopEasy</h3>
            <p>
              Your one-stop destination for all daily essentials at the best
              prices.
            </p>
          </div>
          <div class="footer-section">
            <h4>Quick Links</h4>
            <ul>
              <li><a href="#">About Us</a></li>
              <li><a href="#">Contact</a></li>
              <li><a href="#">Help</a></li>
              <li><a href="#">Careers</a></li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>Categories</h4>
            <ul>
              <li>
                <a href="products.html?category=Electronics">Electronics</a>
              </li>
              <li><a href="products.html?category=Fashion">Fashion</a></li>
              <li>
                <a href="products.html?category=Home & Kitchen"
                  >Home & Kitchen</a
                >
              </li>
              <li>
                <a href="products.html?category=Groceries & Food">Groceries</a>
              </li>
            </ul>
          </div>
          <div class="footer-section">
            <h4>Customer Service</h4>
            <ul>
              <li><a href="#">Return Policy</a></li>
              <li><a href="#">Privacy Policy</a></li>
              <li><a href="#">Terms of Service</a></li>
              <li><a href="#">Track Order</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-bottom">
          <p>&copy; 2024 ShopEasy. All rights reserved.</p>
        </div>
      </div>
    </footer>

    <script src="script.js"></script>
    <script src="voice-search.js"></script>
    <script src="ar-viewer.js"></script>
    <script src="recommendations.js"></script>
    <script src="store-locator.js"></script>

    <!-- AR Feature Scripts -->
    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/AR-js-org/AR.js/aframe/build/aframe-ar.min.js"></script>
    <script src="scripts/ar-viewer.js"></script>
    <script src="scripts/ar-integration.js"></script>

    <!-- AR Styles -->
    <link rel="stylesheet" href="styles/ar-viewer.css" />
    <script>
      function getProductId() {
        const params = new URLSearchParams(window.location.search);
        return params.get("id");
      }

      function updateBreadcrumb(product) {
        const breadcrumb = document.getElementById("breadcrumb");
        breadcrumb.innerHTML = `
                <a href="index.html" style="color: #3b82f6;">Home</a>
                <span style="margin: 0 0.5rem;">‚Ä∫</span>
                <a href="products.html?category=${encodeURIComponent(product.category)}" style="color: #3b82f6;">${product.category}</a>
                <span style="margin: 0 0.5rem;">‚Ä∫</span>
                <span style="color: #111827;">${product.name}</span>
            `;
      }

      function createProductDetail(product) {
        const isInCart = window.cart.some((item) => item.id === product.id);
        const savings =
          product.originalPrice && product.originalPrice > product.price
            ? product.originalPrice - product.price
            : 0;

        return `
                <div class="product-detail-grid">
                    <!-- Product Image -->
                    <div class="product-image-section">
                        <img src="${product.image}" alt="${product.name}" class="product-main-image">

                        <div class="product-badges">
                            ${product.discount ? `<div class="discount-badge">${product.discount}% OFF</div>` : ""}
                        </div>

                        <div class="product-actions-top">
                            <button class="action-btn">
                                <svg style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.29 1.51 4.04 3 5.5l7 7Z"/>
                                </svg>
                            </button>
                            <button class="action-btn">
                                <svg style="width: 1rem; height: 1rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8"/>
                                    <polyline points="16,6 12,2 8,6"/>
                                    <line x1="12" x2="12" y1="2" y2="15"/>
                                </svg>
                            </button>
                        </div>
                    </div>

                    <!-- Product Info -->
                    <div class="product-info-section">
                        <div class="product-meta">
                            <span class="meta-badge category-badge">${product.category}</span>
                            ${product.brand ? `<span class="meta-badge brand-badge">${product.brand}</span>` : ""}
                        </div>

                        <h1 class="product-title">${product.name}</h1>

                        <div class="product-rating-section">
                            <div class="rating-display">
                                <div class="rating-stars">
                                    ${window.createStarRating(product.rating)}
                                </div>
                                <span class="rating-text">${product.rating}</span>
                            </div>
                            <span class="reviews-text">(${window.formatNumber(product.reviews)} reviews)</span>
                        </div>

                        <div class="price-section">
                            <div class="price-display">
                                <span class="current-price">${window.formatPrice(product.price)}</span>
                                ${product.originalPrice ? `<span class="original-price">${window.formatPrice(product.originalPrice)}</span>` : ""}
                            </div>
                            ${savings > 0 ? `<p class="savings-text">You save ${window.formatPrice(savings)} (${product.discount}% off)</p>` : ""}
                        </div>

                        <div class="stock-status">
                            ${product.inStock ? '<span class="in-stock">In Stock</span>' : '<span class="out-of-stock">Out of Stock</span>'}
                        </div>

                        <div class="description-section">
                            <h3 class="section-title">Description</h3>
                            <p>${product.description}</p>
                        </div>

                        ${
                          product.features && product.features.length > 0
                            ? `
                            <div class="features-section">
                                <h3 class="section-title">Key Features</h3>
                                <ul class="features-list">
                                    ${product.features.map((feature) => `<li>${feature}</li>`).join("")}
                                </ul>
                            </div>
                        `
                            : ""
                        }

                        <div class="action-buttons">
                            <button
                                class="btn btn-primary btn-large"
                                onclick="addToCartFromDetail('${product.id}')"
                                ${!product.inStock || isInCart ? "disabled" : ""}
                            >
                                <svg style="width: 1.25rem; height: 1.25rem;" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="m9 22 3-3-3-3M3 3h.621a1 1 0 0 1 .958.713l1.42 4.982A1 1 0 0 0 6.957 9H19a1 1 0 0 1 .97 1.243l-2 8A1 1 0 0 1 17 19H6a1 1 0 0 1-.97-.757L2 2H1"/>
                                    <circle cx="9" cy="22" r="1"/>
                                    <circle cx="20" cy="22" r="1"/>
                                </svg>
                                ${isInCart ? "Added to Cart" : "Add to Cart"}
                            </button>
                            <button class="btn btn-outline btn-large">
                                Buy Now
                            </button>
                        </div>

                        <!-- Bargaining Section -->
                        <div style="
                            background: linear-gradient(135deg, #f59e0b, #d97706);
                            color: white;
                            padding: 1.5rem;
                            border-radius: 0.75rem;
                            margin-top: 1.5rem;
                        ">
                            <h3 style="
                                font-size: 1.125rem;
                                font-weight: 700;
                                margin-bottom: 1rem;
                                display: flex;
                                align-items: center;
                                gap: 0.5rem;
                            ">
                                <span style="font-size: 1.5rem;">ü§ù</span>
                                Bargain for Better Price
                            </h3>
                            <p style="
                                margin-bottom: 1.5rem;
                                opacity: 0.95;
                                line-height: 1.5;
                                font-size: 0.95rem;
                            ">
                                Chat with nearby stores to negotiate the best price! Save ‚Çπ${Math.round(product.price * 0.1)} - ‚Çπ${Math.round(product.price * 0.25)} through direct negotiation.
                            </p>
                            <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                                <button
                                    onclick="storeBargaining.openBargainingInterface(product)"
                                    style="
                                        background: rgba(255, 255, 255, 0.2);
                                        color: white;
                                        border: 1px solid rgba(255, 255, 255, 0.3);
                                        padding: 0.75rem 1.5rem;
                                        border-radius: 0.75rem;
                                        font-weight: 600;
                                        cursor: pointer;
                                        display: flex;
                                        align-items: center;
                                        gap: 0.5rem;
                                        transition: all 0.2s;
                                        backdrop-filter: blur(10px);
                                        flex: 1;
                                        justify-content: center;
                                        min-width: 200px;
                                    "
                                    onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'"
                                    onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'"
                                >
                                    üí¨ Find Nearby Stores
                                </button>
                                <a href="tel:+919876543210" style="
                                    background: rgba(255, 255, 255, 0.2);
                                    color: white;
                                    border: 1px solid rgba(255, 255, 255, 0.3);
                                    padding: 0.75rem 1.5rem;
                                    border-radius: 0.75rem;
                                    font-weight: 600;
                                    text-decoration: none;
                                    display: flex;
                                    align-items: center;
                                    gap: 0.5rem;
                                    transition: all 0.2s;
                                    backdrop-filter: blur(10px);
                                    justify-content: center;
                                    min-width: 120px;
                                "
                                onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'"
                                onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'"
                                >
                                    üìû Call Store
                                </a>
                            </div>
                            <div style="
                                margin-top: 1rem;
                                padding: 1rem;
                                background: rgba(255, 255, 255, 0.1);
                                border-radius: 0.75rem;
                                border: 1px solid rgba(255, 255, 255, 0.2);
                            ">
                                <div style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
                                    <span style="font-size: 1rem;">üí°</span>
                                    <span style="font-weight: 600; font-size: 0.9rem;">Why Bargain?</span>
                                </div>
                                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 0.75rem; font-size: 0.875rem;">
                                    <div>‚úÖ Get better prices</div>
                                    <div>‚úÖ Local warranty support</div>
                                    <div>‚úÖ Same-day delivery</div>
                                    <div>‚úÖ Personal service</div>
                                </div>
                            </div>
                        </div>

                        <!-- AR/VR Experience Section -->
                        <div style="
                            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
                            color: white;
                            padding: 1.5rem;
                            border-radius: 0.75rem;
                            margin-top: 1.5rem;
                        ">
                            <h3 style="
                                font-size: 1.125rem;
                                font-weight: 700;
                                margin-bottom: 1rem;
                                display: flex;
                                align-items: center;
                                gap: 0.5rem;
                            ">
                                <span style="font-size: 1.5rem;">ü•Ω</span>
                                Experience in AR/VR
                            </h3>
                            <p style="
                                opacity: 0.9;
                                margin-bottom: 1.5rem;
                                font-size: 0.875rem;
                            ">
                                See how ${product.name} looks in your space or explore it in 3D before buying!
                            </p>
                            <div style="
                                display: grid;
                                grid-template-columns: 1fr 1fr 1fr;
                                gap: 0.75rem;
                            ">
                                <button
                                    onclick="arViewer && arViewer.openARViewer(${JSON.stringify(product).replace(/"/g, "&quot;")})"
                                    style="
                                        background: rgba(255, 255, 255, 0.2);
                                        color: white;
                                        border: 1px solid rgba(255, 255, 255, 0.3);
                                        padding: 0.75rem 0.5rem;
                                        border-radius: 0.5rem;
                                        cursor: pointer;
                                        font-weight: 500;
                                        font-size: 0.875rem;
                                        text-align: center;
                                        transition: all 0.2s;
                                    "
                                    onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'"
                                    onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'"
                                >
                                    üì± AR View
                                </button>
                                <button
                                    onclick="arViewer && arViewer.open3DViewer(${JSON.stringify(product).replace(/"/g, "&quot;")})"
                                    style="
                                        background: rgba(255, 255, 255, 0.2);
                                        color: white;
                                        border: 1px solid rgba(255, 255, 255, 0.3);
                                        padding: 0.75rem 0.5rem;
                                        border-radius: 0.5rem;
                                        cursor: pointer;
                                        font-weight: 500;
                                        font-size: 0.875rem;
                                        text-align: center;
                                        transition: all 0.2s;
                                    "
                                    onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'"
                                    onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'"
                                >
                                    üîÑ 3D View
                                </button>
                                <button
                                    onclick="arViewer && arViewer.openVRViewer(${JSON.stringify(product).replace(/"/g, "&quot;")})"
                                    style="
                                        background: rgba(255, 255, 255, 0.2);
                                        color: white;
                                        border: 1px solid rgba(255, 255, 255, 0.3);
                                        padding: 0.75rem 0.5rem;
                                        border-radius: 0.5rem;
                                        cursor: pointer;
                                        font-weight: 500;
                                        font-size: 0.875rem;
                                        text-align: center;
                                        transition: all 0.2s;
                                    "
                                    onmouseover="this.style.background='rgba(255, 255, 255, 0.3)'"
                                    onmouseout="this.style.background='rgba(255, 255, 255, 0.2)'"
                                >
                                    ü•Ω VR View
                                </button>
                            </div>
                        </div>

                        <div class="services-card">
                            <div class="service-item">
                                <svg class="service-icon delivery" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M14 18V6a2 2 0 0 0-2-2H4a2 2 0 0 0-2 2v11a1 1 0 0 0 1 1h2"/>
                                    <path d="M15 18H9"/>
                                    <path d="M19 18h2a1 1 0 0 0 1-1v-3.65a1 1 0 0 0-.22-.624l-3.48-4.35A1 1 0 0 0 17.52 8H14"/>
                                    <circle cx="17" cy="18" r="2"/>
                                    <circle cx="7" cy="18" r="2"/>
                                </svg>
                                <span class="service-text">Free delivery on orders above ‚Çπ499</span>
                            </div>
                            <div class="service-item">
                                <svg class="service-icon return" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"/>
                                    <path d="M3 3v5h5"/>
                                </svg>
                                <span class="service-text">30-day easy return policy</span>
                            </div>
                            <div class="service-item">
                                <svg class="service-icon security" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10"/>
                                </svg>
                                <span class="service-text">100% secure payment protection</span>
                            </div>
                        </div>
                    </div>
                </div>
            `;
      }

      function addToCartFromDetail(productId) {
        window.addToCart(productId);
        // Refresh the page to update the button state
        setTimeout(() => {
          location.reload();
        }, 1000);
      }

      function loadRelatedProducts(product) {
        const relatedContainer = document.getElementById("relatedProducts");
        const relatedProducts = window.products
          .filter((p) => p.category === product.category && p.id !== product.id)
          .slice(0, 4);

        if (relatedProducts.length > 0) {
          relatedContainer.innerHTML = `
                    <div class="section-header" style="margin-bottom: 2rem;">
                        <h2 style="font-size: 1.875rem; font-weight: 700;">More from ${product.category}</h2>
                    </div>
                    <div class="products-grid">
                        ${relatedProducts.map((p) => window.createProductCard(p)).join("")}
                    </div>
                `;
        } else {
          relatedContainer.style.display = "none";
        }
      }

      // Initialize product detail page
      document.addEventListener("DOMContentLoaded", function () {
        const productId = getProductId();

        if (!productId) {
          window.location.href = "index.html";
          return;
        }

        const product = window.getProductById(productId);

        if (!product) {
          document.getElementById("productDetailContainer").innerHTML = `
                    <div class="text-center" style="padding: 3rem 0;">
                        <h1 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;">Product not found</h1>
                        <p style="color: #6b7280; margin-bottom: 2rem;">The product you're looking for doesn't exist.</p>
                        <a href="index.html" class="btn btn-primary">Back to Home</a>
                    </div>
                `;
          return;
        }

        // Update page title
        document.title = `${product.name} - ShopEasy`;

        // Update breadcrumb
        updateBreadcrumb(product);

        // Create product detail
        document.getElementById("productDetailContainer").innerHTML =
          createProductDetail(product);

        // Load related products
        loadRelatedProducts(product);

        // Track product view for recommendations
        if (window.recommendationEngine) {
          window.recommendationEngine.trackProductView(product);
        }
      });

      // Define showUserInsights globally for account button
      window.showUserInsights = function () {
        if (!window.recommendationEngine) {
          alert(
            "Recommendation engine not loaded yet. Please try again in a moment.",
          );
          return;
        }

        const insights = window.recommendationEngine.getUserInsights();
        const modal = document.createElement("div");
        modal.style.cssText = `
          position: fixed;
          inset: 0;
          background: rgba(0, 0, 0, 0.5);
          z-index: 10000;
          display: flex;
          align-items: center;
          justify-content: center;
          padding: 1rem;
        `;

        modal.innerHTML = `
          <div style="
            background: white;
            border-radius: 1rem;
            padding: 2rem;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
          ">
            <h2 style="font-size: 1.5rem; font-weight: 700; margin-bottom: 1.5rem; text-align: center;">
              üìä Your Shopping Insights
            </h2>

            <div style="space-y: 1rem;">
              <div style="margin-bottom: 1rem;">
                <h3 style="font-weight: 600; margin-bottom: 0.5rem;">üìà Activity</h3>
                <p>Total products viewed: <strong>${insights.totalViews}</strong></p>
              </div>

              <div style="margin-bottom: 1rem;">
                <h3 style="font-weight: 600; margin-bottom: 0.5rem;">‚ù§Ô∏è Favorite Categories</h3>
                ${
                  insights.topCategories.length > 0
                    ? insights.topCategories
                        .map(
                          ([category, count]) =>
                            `<p>‚Ä¢ ${category}: ${count} views</p>`,
                        )
                        .join("")
                    : '<p style="color: #6b7280;">No favorites yet - start browsing to see personalized recommendations!</p>'
                }
              </div>

              <div style="margin-bottom: 1rem;">
                <h3 style="font-weight: 600; margin-bottom: 0.5rem;">üè∑Ô∏è Favorite Brands</h3>
                ${
                  insights.topBrands.length > 0
                    ? insights.topBrands
                        .map(
                          ([brand, count]) =>
                            `<p>‚Ä¢ ${brand}: ${count} views</p>`,
                        )
                        .join("")
                    : '<p style="color: #6b7280;">No brand preferences yet - explore products to build your profile!</p>'
                }
              </div>

              <div style="margin-bottom: 1.5rem;">
                <h3 style="font-weight: 600; margin-bottom: 0.5rem;">üí∞ Price Range</h3>
                <p>‚Çπ${insights.priceRange.min.toLocaleString()} - ‚Çπ${insights.priceRange.max.toLocaleString()}</p>
              </div>
            </div>

            <div style="display: flex; gap: 1rem;">
              <button onclick="this.closest('div').parentElement.remove()" style="
                flex: 1;
                background: #6b7280;
                color: white;
                border: none;
                padding: 0.75rem;
                border-radius: 0.5rem;
                cursor: pointer;
                font-weight: 500;
              ">Close</button>
              <button onclick="window.clearBrowsingHistory()" style="
                flex: 1;
                background: #ef4444;
                color: white;
                border: none;
                padding: 0.75rem;
                border-radius: 0.5rem;
                cursor: pointer;
                font-weight: 500;
              ">Clear History</button>
            </div>
          </div>
        `;

        document.body.appendChild(modal);
      };

      window.clearBrowsingHistory = function () {
        if (
          confirm(
            "Are you sure you want to clear your browsing history and preferences? This will reset all personalized recommendations.",
          )
        ) {
          if (window.recommendationEngine) {
            window.recommendationEngine.clearBrowsingHistory();
          }
          document.querySelector('[style*="position: fixed"]').remove();
          alert("Browsing history cleared! Recommendations will be reset.");
          window.location.reload();
        }
      };
    </script>

    <!-- Chatbot Integration -->
    <script src="scripts/chatbot.js"></script>
    <div id="chatbot-component"></div>
    <script>
      // Load chatbot component
      fetch("components/chatbot.html")
        .then((response) => response.text())
        .then((html) => {
          document.getElementById("chatbot-component").innerHTML = html;
        });
    </script>

    <!-- Image Search Integration -->
    <script src="scripts/image-search.js"></script>
  </body>
</html>
